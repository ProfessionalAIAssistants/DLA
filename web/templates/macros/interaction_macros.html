{# Interaction Macros - Modular form components for interaction management #}

{# Import base form macros #}
{% from 'macros/form_macros.html' import text_input, select_input, textarea_input, date_input %}
{% from 'macros/modal_macros.html' import form_modal %}

{# Edit Interaction Modal Macro #}
{% macro edit_interaction_modal(interaction_id=None) %}
{% set form_content %}
<div id="editInteractionFormContainer">
    <div class="row g-3">
        <div class="col-md-6">
            {{ select_input('editInteractionType', 'Type', [
                {'value': 'Call', 'label': 'Call'},
                {'value': 'Email', 'label': 'Email'},
                {'value': 'LinkedIn', 'label': 'LinkedIn'},
                {'value': 'Text', 'label': 'Text'},
                {'value': 'Meeting', 'label': 'Meeting'},
                {'value': 'Other', 'label': 'Other'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            {{ select_input('editDirection', 'Direction', [
                {'value': 'Out Going', 'label': 'Out Going'},
                {'value': 'In Coming', 'label': 'In Coming'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            <label class="form-label">Date & Time *</label>
            <input type="datetime-local" class="form-control" id="editInteractionDate" name="interaction_date" required>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="editDurationMinutes" class="form-label">Duration (minutes)</label>
                <input type="number" class="form-control" id="editDurationMinutes" name="duration_minutes" min="0">
            </div>
        </div>
        <div class="col-md-6">
            {{ select_input('editStatus', 'Status', [
                {'value': 'Completed', 'label': 'Completed'},
                {'value': 'Pending', 'label': 'Pending'},
                {'value': 'Failed', 'label': 'Failed'}
            ]) }}
        </div>
        <div class="col-md-6">
            {{ text_input('editLocation', 'Location', placeholder='Meeting location, phone number, etc.') }}
        </div>
        <div class="col-md-12">
            {{ text_input('editSubject', 'Subject', required=True) }}
        </div>
        <div class="col-md-4">
            {{ select_input('editContactId', 'Contact', [], empty_option='Select Contact') }}
        </div>
        <div class="col-md-4">
            {{ select_input('editOpportunityId', 'Opportunity', [], empty_option='Select Opportunity') }}
        </div>
        <div class="col-md-4">
            {{ select_input('editProjectId', 'Project', [], empty_option='Select Project') }}
        </div>
        <div class="col-md-12">
            {{ textarea_input('editDescription', 'Description/Notes', rows=4) }}
        </div>
        <div class="col-md-12">
            {{ textarea_input('editOutcome', 'Outcome', rows=3) }}
        </div>
        {% if interaction_id %}
        <input type="hidden" id="editInteractionId" value="{{ interaction_id }}">
        {% endif %}
    </div>
</div>
{% endset %}

{{ form_modal('editInteractionModal', 'Edit Interaction', form_content, 'Save Changes', 'Cancel', 'saveInteraction()', 'lg', 'fas fa-edit') }}
{% endmacro %}

{# Create Follow-up Modal Macro #}
{% macro create_followup_modal(interaction_id=None) %}
{% set form_content %}
<div id="createFollowupFormContainer">
    <div class="row g-3">
        <div class="col-md-6">
            {{ select_input('followupType', 'Type', [
                {'value': 'Call', 'label': 'Call'},
                {'value': 'Email', 'label': 'Email'},
                {'value': 'LinkedIn', 'label': 'LinkedIn'},
                {'value': 'Text', 'label': 'Text'},
                {'value': 'Meeting', 'label': 'Meeting'},
                {'value': 'Other', 'label': 'Other'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            {{ select_input('followupDirection', 'Direction', [
                {'value': 'Out Going', 'label': 'Out Going'},
                {'value': 'In Coming', 'label': 'In Coming'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            <label class="form-label">Scheduled Date & Time *</label>
            <input type="datetime-local" class="form-control" id="followupDate" name="interaction_date" required>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="followupDurationMinutes" class="form-label">Expected Duration (minutes)</label>
                <input type="number" class="form-control" id="followupDurationMinutes" name="duration_minutes" min="0">
            </div>
        </div>
        <div class="col-md-6">
            {{ select_input('followupStatus', 'Status', [
                {'value': 'Pending', 'label': 'Pending'},
                {'value': 'Completed', 'label': 'Completed'},
                {'value': 'Failed', 'label': 'Failed'}
            ], selected='Pending') }}
        </div>
        <div class="col-md-6">
            {{ text_input('followupLocation', 'Location', placeholder='Meeting location, phone number, etc.') }}
        </div>
        <div class="col-md-12">
            {{ text_input('followupSubject', 'Subject', required=True, placeholder='Follow-up: ') }}
        </div>
        <div class="col-md-4">
            {{ select_input('followupContactId', 'Contact', [], empty_option='Select Contact') }}
        </div>
        <div class="col-md-4">
            {{ select_input('followupOpportunityId', 'Opportunity', [], empty_option='Select Opportunity') }}
        </div>
        <div class="col-md-4">
            {{ select_input('followupProjectId', 'Project', [], empty_option='Select Project') }}
        </div>
        <div class="col-md-12">
            {{ textarea_input('followupDescription', 'Description/Notes', rows=4, placeholder='Follow-up to previous interaction...') }}
        </div>
        {% if interaction_id %}
        <input type="hidden" id="followupParentId" value="{{ interaction_id }}">
        {% endif %}
    </div>
</div>
{% endset %}

{{ form_modal('createFollowupModal', 'Create Follow-up Interaction', form_content, 'Create Follow-up', 'Cancel', 'saveFollowup()', 'lg', 'fas fa-plus') }}
{% endmacro %}

{# Duplicate Interaction Modal Macro #}
{% macro duplicate_interaction_modal(interaction_id=None) %}
{% set form_content %}
<div id="duplicateInteractionFormContainer">
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        This will create a new interaction based on the current one. You can modify the details before saving.
    </div>
    <div class="row g-3">
        <div class="col-md-6">
            {{ select_input('duplicateInteractionType', 'Type', [
                {'value': 'Call', 'label': 'Call'},
                {'value': 'Email', 'label': 'Email'},
                {'value': 'LinkedIn', 'label': 'LinkedIn'},
                {'value': 'Text', 'label': 'Text'},
                {'value': 'Meeting', 'label': 'Meeting'},
                {'value': 'Other', 'label': 'Other'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            {{ select_input('duplicateDirection', 'Direction', [
                {'value': 'Out Going', 'label': 'Out Going'},
                {'value': 'In Coming', 'label': 'In Coming'}
            ], required=True) }}
        </div>
        <div class="col-md-6">
            <label class="form-label">Date & Time *</label>
            <input type="datetime-local" class="form-control" id="duplicateInteractionDate" name="interaction_date" required>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="duplicateDurationMinutes" class="form-label">Duration (minutes)</label>
                <input type="number" class="form-control" id="duplicateDurationMinutes" name="duration_minutes" min="0">
            </div>
        </div>
        <div class="col-md-6">
            {{ select_input('duplicateStatus', 'Status', [
                {'value': 'Pending', 'label': 'Pending'},
                {'value': 'Completed', 'label': 'Completed'},
                {'value': 'Failed', 'label': 'Failed'}
            ]) }}
        </div>
        <div class="col-md-6">
            {{ text_input('duplicateLocation', 'Location', placeholder='Meeting location, phone number, etc.') }}
        </div>
        <div class="col-md-12">
            {{ text_input('duplicateSubject', 'Subject', required=True) }}
        </div>
        <div class="col-md-4">
            {{ select_input('duplicateContactId', 'Contact', [], empty_option='Select Contact') }}
        </div>
        <div class="col-md-4">
            {{ select_input('duplicateOpportunityId', 'Opportunity', [], empty_option='Select Opportunity') }}
        </div>
        <div class="col-md-4">
            {{ select_input('duplicateProjectId', 'Project', [], empty_option='Select Project') }}
        </div>
        <div class="col-md-12">
            {{ textarea_input('duplicateDescription', 'Description/Notes', rows=4) }}
        </div>
        {% if interaction_id %}
        <input type="hidden" id="duplicateSourceId" value="{{ interaction_id }}">
        {% endif %}
    </div>
</div>
{% endset %}

{{ form_modal('duplicateInteractionModal', 'Duplicate Interaction', form_content, 'Create Duplicate', 'Cancel', 'saveDuplicate()', 'lg', 'fas fa-copy') }}
{% endmacro %}{% macro interactions_page_header() %}
<div class="row mb-5">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="display-6 fw-bold mb-2">
                    <i class="fas fa-comments me-3" style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                    Interactions
                </h1>
                <p class="text-muted mb-0 fs-5">Track communications and engagement activities</p>
            </div>
            <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addInteractionModal">
                <i class="fas fa-plus me-2"></i> Add Interaction
            </button>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_stats_cards(stats) %}
<div class="row mb-5">
    <div class="col-md-3">
        <div class="card card-metric h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark mb-2 text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px; opacity: 0.8;">Total Interactions</h6>
                    <h2 class="mb-0 fw-bold text-dark">{{ stats.total }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-comments fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric success h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark mb-2 text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px; opacity: 0.8;">Today</h6>
                    <h2 class="mb-0 fw-bold text-dark">{{ stats.today }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-calendar-day fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric info h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark-50 mb-2 text-uppercase" style="font-size: 0.75rem; letter-spacing: 1px;">This Week</h6>
                    <h2 class="mb-0 fw-bold">{{ stats.this_week }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-calendar-week fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric warning h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark-50 mb-2 text-uppercase" style="font-size: 0.75rem; letter-spacing: 1px;">Pending</h6>
                    <h2 class="mb-0 fw-bold">{{ stats.pending }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-clock fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_filters(filters) %}
<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                </h5>
            </div>
            <div id="filtersCollapse" class="collapse">
                <div class="card-body">
                    <form method="GET" id="filterForm">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="type_filter" class="form-label">Type</label>
                                <select class="form-select" id="type_filter" name="type">
                                    <option value="">All Types</option>
                                    <option value="Call" {% if filters.type == 'Call' %}selected{% endif %}>Call</option>
                                    <option value="Email" {% if filters.type == 'Email' %}selected{% endif %}>Email</option>
                                    <option value="LinkedIn" {% if filters.type == 'LinkedIn' %}selected{% endif %}>LinkedIn</option>
                                    <option value="Text" {% if filters.type == 'Text' %}selected{% endif %}>Text</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="direction_filter" class="form-label">Direction</label>
                                <select class="form-select" id="direction_filter" name="direction">
                                    <option value="">All Directions</option>
                                    <option value="Out Going" {% if filters.direction == 'Out Going' %}selected{% endif %}>Out Going</option>
                                    <option value="In Coming" {% if filters.direction == 'In Coming' %}selected{% endif %}>In Coming</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="project_filter" class="form-label">Project</label>
                                <select class="form-select" id="project_filter" name="project_id">
                                    <option value="">All Projects</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="status_filter" class="form-label">Status</label>
                                <select class="form-select" id="status_filter" name="status">
                                    <option value="">All Statuses</option>
                                    <option value="Pending" {% if filters.status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="Completed" {% if filters.status == 'Completed' %}selected{% endif %}>Completed</option>
                                    <option value="Failed" {% if filters.status == 'Failed' %}selected{% endif %}>Failed</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="start_date_filter" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="start_date_filter" name="start_date" value="{{ filters.start_date or '' }}">
                            </div>
                            <div class="col-md-2">
                                <label for="end_date_filter" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="end_date_filter" name="end_date" value="{{ filters.end_date or '' }}">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary me-2">Apply</button>
                                <a href="{{ url_for('interactions') }}" class="btn btn-secondary">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_table(interactions) %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Interactions ({{ interactions|length }} found)</h5>
            </div>
            <div class="card-body">
                {% if interactions %}
                <div class="mb-2">
                    <small class="text-muted">Double-click any interaction to view details</small>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Date/Time</th>
                                <th>Type</th>
                                <th>Direction</th>
                                <th>Subject</th>
                                <th>Contact</th>
                                <th>Opportunity</th>
                                <th>Project</th>
                                <th>Status</th>
                                <th>Duration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for interaction in interactions %}
                            <tr style="cursor: pointer;" 
                                ondblclick="window.location.href='/interactions/{{ interaction.id }}'"
                                onmouseover="this.style.backgroundColor='#f8f9fa';" 
                                onmouseout="this.style.backgroundColor='';"
                                title="Double-click to view interaction details">
                                <td>
                                    <div class="fw-bold">{{ interaction.interaction_date.split(' ')[0] if interaction.interaction_date else 'N/A' }}</div>
                                    <small class="text-muted">{{ interaction.interaction_date.split(' ')[1] if interaction.interaction_date and ' ' in interaction.interaction_date else '' }}</small>
                                </td>
                                <td>
                                    {% if interaction.type == 'Call' %}
                                        <span class="badge bg-primary"><i class="fas fa-phone"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'Email' %}
                                        <span class="badge bg-info"><i class="fas fa-envelope"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'LinkedIn' %}
                                        <span class="badge bg-secondary"><i class="fab fa-linkedin"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'Text' %}
                                        <span class="badge bg-success"><i class="fas fa-sms"></i> {{ interaction.type }}</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.type or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.direction == 'Out Going' %}
                                        <span class="badge bg-warning"><i class="fas fa-arrow-up"></i> Out Going</span>
                                    {% elif interaction.direction == 'In Coming' %}
                                        <span class="badge bg-success"><i class="fas fa-arrow-down"></i> In Coming</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.direction or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="fw-bold">{{ interaction.subject or 'No Subject' }}</div>
                                    {% if interaction.message %}
                                                                {% if interaction.description %}
                        <small class="text-muted">{{ (interaction.description or 'No description')[:100] }}{% if (interaction.description or '')|length > 100 %}...{% endif %}</small>
                    {% endif %}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.contact_name %}
                                        <div class="fw-bold">{{ interaction.contact_name }}</div>
                                        {% if interaction.contact_email_addr %}
                                            <small class="text-muted">{{ interaction.contact_email_addr }}</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">No Contact</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.opportunity_name %}
                                        <span class="badge bg-info">{{ interaction.opportunity_name }}</span>
                                    {% else %}
                                        <span class="text-muted">No Opportunity</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.project_name %}
                                        <span class="badge bg-secondary">{{ interaction.project_name }}</span>
                                    {% else %}
                                        <span class="text-muted">No Project</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.status == 'Completed' %}
                                        <span class="badge bg-success">{{ interaction.status }}</span>
                                    {% elif interaction.status == 'Pending' %}
                                        <span class="badge bg-warning">{{ interaction.status }}</span>
                                    {% elif interaction.status == 'Failed' %}
                                        <span class="badge bg-danger">{{ interaction.status }}</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.status or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.duration_minutes %}
                                        {{ interaction.duration_minutes }} min
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="/interactions/{{ interaction.id }}" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editInteraction({{ interaction.id }})" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteInteraction({{ interaction.id }})" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No interactions found</h5>
                    <p class="text-muted">Start by adding your first interaction or adjust your filters.</p>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInteractionModal">
                        <i class="fas fa-plus"></i> Add First Interaction
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro add_interaction_modal() %}
<div class="modal fade" id="addInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add New Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addInteractionForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_type" class="form-label">Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="add_type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="Call">Call</option>
                                    <option value="Email">Email</option>
                                    <option value="LinkedIn">LinkedIn</option>
                                    <option value="Text">Text</option>
                                    <option value="Meeting">Meeting</option>
                                    <option value="Note">Note</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_direction" class="form-label">Direction <span class="text-danger">*</span></label>
                                <select class="form-select" id="add_direction" name="direction" required>
                                    <option value="">Select Direction</option>
                                    <option value="Out Going">Out Going</option>
                                    <option value="In Coming">In Coming</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_interaction_date" class="form-label">Date/Time</label>
                                <input type="datetime-local" class="form-control" id="add_interaction_date" name="interaction_date">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_status" class="form-label">Status</label>
                                <select class="form-select" id="add_status" name="status">
                                    <option value="Completed">Completed</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Failed">Failed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="add_subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="add_subject" name="subject" placeholder="Brief description of the interaction">
                    </div>
                    <div class="mb-3">
                        <label for="add_description" class="form-label">Description/Notes</label>
                        <textarea class="form-control" id="add_description" name="description" rows="4" placeholder="Detailed notes about the interaction"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_contact_id" class="form-label">Contact</label>
                                <select class="form-select" id="add_contact_id" name="contact_id">
                                    <option value="">Select Contact</option>
                                    <!-- Contacts will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_opportunity_id" class="form-label">Opportunity</label>
                                <select class="form-select" id="add_opportunity_id" name="opportunity_id">
                                    <option value="">Select Opportunity</option>
                                    <!-- Opportunities will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_project_id" class="form-label">Project</label>
                                <select class="form-select" id="add_project_id" name="project_id">
                                    <option value="">Select Project</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_duration_minutes" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="add_duration_minutes" name="duration_minutes" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="add_location" name="location" placeholder="Meeting location or phone number">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="add_outcome" class="form-label">Outcome</label>
                        <textarea class="form-control" id="add_outcome" name="outcome" rows="2" placeholder="Result or outcome of the interaction"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInteraction()">Save Interaction</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro view_interaction_modal() %}
<div class="modal fade" id="viewInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-eye"></i> View Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="viewInteractionContent">
                <!-- Content will be loaded via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editInteractionFromView()">Edit</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro edit_interaction_modal() %}
<div class="modal fade" id="editInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editInteractionForm">
                    <input type="hidden" id="edit_interaction_id" name="id">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_type" class="form-label">Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="edit_type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="Call">Call</option>
                                    <option value="Email">Email</option>
                                    <option value="LinkedIn">LinkedIn</option>
                                    <option value="Text">Text</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_direction" class="form-label">Direction <span class="text-danger">*</span></label>
                                <select class="form-select" id="edit_direction" name="direction" required>
                                    <option value="">Select Direction</option>
                                    <option value="Out Going">Out Going</option>
                                    <option value="In Coming">In Coming</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_status" class="form-label">Status</label>
                                <select class="form-select" id="edit_status" name="status">
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Failed">Failed</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_interaction_date" class="form-label">Date/Time</label>
                                <input type="datetime-local" class="form-control" id="edit_interaction_date" name="interaction_date">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit_subject" name="subject">
                    </div>
                    <div class="mb-3">
                        <label for="edit_description" class="form-label">Description/Notes</label>
                        <textarea class="form-control" id="edit_description" name="description" rows="4"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_contact_id" class="form-label">Contact</label>
                                <select class="form-select" id="edit_contact_id" name="contact_id">
                                    <option value="">Select Contact</option>
                                    <!-- Contacts will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_opportunity_id" class="form-label">Opportunity</label>
                                <select class="form-select" id="edit_opportunity_id" name="opportunity_id">
                                    <option value="">Select Opportunity</option>
                                    <!-- Opportunities will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_project_id" class="form-label">Project</label>
                                <select class="form-select" id="edit_project_id" name="project_id">
                                    <option value="">Select Project</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <!-- Empty column for alignment -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_duration_minutes" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="edit_duration_minutes" name="duration_minutes" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="edit_location" name="location">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_outcome" class="form-label">Outcome</label>
                        <textarea class="form-control" id="edit_outcome" name="outcome" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateInteraction()">Update Interaction</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{# ========== INTERACTION LIST PAGE MACROS ========== #}
{# These macros are for the interactions listing page #}

{% macro interactions_page_header() %}
<div class="row mb-5">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="display-6 fw-bold mb-2">
                    <i class="fas fa-comments me-3" style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                    Interactions
                </h1>
                <p class="text-muted mb-0 fs-5">Track communications and engagement activities</p>
            </div>
            <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addInteractionModal">
                <i class="fas fa-plus me-2"></i> Add Interaction
            </button>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_stats_cards(stats) %}
<div class="row mb-5">
    <div class="col-md-3">
        <div class="card card-metric h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark mb-2 text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px; opacity: 0.8;">Total Interactions</h6>
                    <h2 class="mb-0 fw-bold text-dark">{{ stats.total }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-comments fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric success h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark mb-2 text-uppercase fw-bold" style="font-size: 0.75rem; letter-spacing: 1px; opacity: 0.8;">Today</h6>
                    <h2 class="mb-0 fw-bold text-dark">{{ stats.today }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-calendar-day fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric info h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark-50 mb-2 text-uppercase" style="font-size: 0.75rem; letter-spacing: 1px;">This Week</h6>
                    <h2 class="mb-0 fw-bold">{{ stats.this_week }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-calendar-week fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-metric warning h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1">
                    <h6 class="text-dark-50 mb-2 text-uppercase" style="font-size: 0.75rem; letter-spacing: 1px;">Pending</h6>
                    <h2 class="mb-0 fw-bold">{{ stats.pending }}</h2>
                </div>
                <div class="ms-3">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                         style="width: 50px; height: 50px; background: rgba(255,255,255,0.2);">
                        <i class="fas fa-clock fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_filters(filters) %}
<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                </h5>
            </div>
            <div id="filtersCollapse" class="collapse">
                <div class="card-body">
                    <form method="GET" id="filterForm">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="type_filter" class="form-label">Type</label>
                                <select class="form-select" id="type_filter" name="type">
                                    <option value="">All Types</option>
                                    <option value="Call" {% if filters.type == 'Call' %}selected{% endif %}>Call</option>
                                    <option value="Email" {% if filters.type == 'Email' %}selected{% endif %}>Email</option>
                                    <option value="LinkedIn" {% if filters.type == 'LinkedIn' %}selected{% endif %}>LinkedIn</option>
                                    <option value="Text" {% if filters.type == 'Text' %}selected{% endif %}>Text</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="direction_filter" class="form-label">Direction</label>
                                <select class="form-select" id="direction_filter" name="direction">
                                    <option value="">All Directions</option>
                                    <option value="Out Going" {% if filters.direction == 'Out Going' %}selected{% endif %}>Out Going</option>
                                    <option value="In Coming" {% if filters.direction == 'In Coming' %}selected{% endif %}>In Coming</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="project_filter" class="form-label">Project</label>
                                <select class="form-select" id="project_filter" name="project_id">
                                    <option value="">All Projects</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="status_filter" class="form-label">Status</label>
                                <select class="form-select" id="status_filter" name="status">
                                    <option value="">All Statuses</option>
                                    <option value="Pending" {% if filters.status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="Completed" {% if filters.status == 'Completed' %}selected{% endif %}>Completed</option>
                                    <option value="Failed" {% if filters.status == 'Failed' %}selected{% endif %}>Failed</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="start_date_filter" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="start_date_filter" name="start_date" value="{{ filters.start_date or '' }}">
                            </div>
                            <div class="col-md-2">
                                <label for="end_date_filter" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="end_date_filter" name="end_date" value="{{ filters.end_date or '' }}">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary me-2">Apply</button>
                                <a href="{{ url_for('interactions') }}" class="btn btn-secondary">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro interactions_table(interactions) %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Interactions ({{ interactions|length }} found)</h5>
            </div>
            <div class="card-body">
                {% if interactions %}
                <div class="mb-2">
                    <small class="text-muted">Double-click any interaction to view details</small>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Date/Time</th>
                                <th>Type</th>
                                <th>Direction</th>
                                <th>Subject</th>
                                <th>Contact</th>
                                <th>Opportunity</th>
                                <th>Project</th>
                                <th>Status</th>
                                <th>Duration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for interaction in interactions %}
                            <tr style="cursor: pointer;" 
                                ondblclick="window.location.href='/interactions/{{ interaction.id }}'"
                                onmouseover="this.style.backgroundColor='#f8f9fa';" 
                                onmouseout="this.style.backgroundColor='';"
                                title="Double-click to view interaction details">
                                <td>
                                    <div class="fw-bold">{{ interaction.interaction_date.split(' ')[0] if interaction.interaction_date else 'N/A' }}</div>
                                    <small class="text-muted">{{ interaction.interaction_date.split(' ')[1] if interaction.interaction_date and ' ' in interaction.interaction_date else '' }}</small>
                                </td>
                                <td>
                                    {% if interaction.type == 'Call' %}
                                        <span class="badge bg-primary"><i class="fas fa-phone"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'Email' %}
                                        <span class="badge bg-info"><i class="fas fa-envelope"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'LinkedIn' %}
                                        <span class="badge bg-secondary"><i class="fab fa-linkedin"></i> {{ interaction.type }}</span>
                                    {% elif interaction.type == 'Text' %}
                                        <span class="badge bg-success"><i class="fas fa-sms"></i> {{ interaction.type }}</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.type or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.direction == 'Out Going' %}
                                        <span class="badge bg-warning"><i class="fas fa-arrow-up"></i> Out Going</span>
                                    {% elif interaction.direction == 'In Coming' %}
                                        <span class="badge bg-success"><i class="fas fa-arrow-down"></i> In Coming</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.direction or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="fw-bold">{{ interaction.subject or 'No Subject' }}</div>
                                    {% if interaction.message %}
                                                                {% if interaction.description %}
                        <small class="text-muted">{{ (interaction.description or 'No description')[:100] }}{% if (interaction.description or '')|length > 100 %}...{% endif %}</small>
                    {% endif %}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.contact_name %}
                                        <div class="fw-bold">{{ interaction.contact_name }}</div>
                                        {% if interaction.contact_email_addr %}
                                            <small class="text-muted">{{ interaction.contact_email_addr }}</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">No Contact</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.opportunity_name %}
                                        <span class="badge bg-info">{{ interaction.opportunity_name }}</span>
                                    {% else %}
                                        <span class="text-muted">No Opportunity</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.project_name %}
                                        <span class="badge bg-secondary">{{ interaction.project_name }}</span>
                                    {% else %}
                                        <span class="text-muted">No Project</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.status == 'Completed' %}
                                        <span class="badge bg-success">{{ interaction.status }}</span>
                                    {% elif interaction.status == 'Pending' %}
                                        <span class="badge bg-warning">{{ interaction.status }}</span>
                                    {% elif interaction.status == 'Failed' %}
                                        <span class="badge bg-danger">{{ interaction.status }}</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ interaction.status or 'N/A' }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if interaction.duration_minutes %}
                                        {{ interaction.duration_minutes }} min
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="/interactions/{{ interaction.id }}" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="editInteraction({{ interaction.id }})" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteInteraction({{ interaction.id }})" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No interactions found</h5>
                    <p class="text-muted">Start by adding your first interaction or adjust your filters.</p>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInteractionModal">
                        <i class="fas fa-plus"></i> Add First Interaction
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro add_interaction_modal() %}
<div class="modal fade" id="addInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add New Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addInteractionForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_type" class="form-label">Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="add_type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="Call">Call</option>
                                    <option value="Email">Email</option>
                                    <option value="LinkedIn">LinkedIn</option>
                                    <option value="Text">Text</option>
                                    <option value="Meeting">Meeting</option>
                                    <option value="Note">Note</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_direction" class="form-label">Direction <span class="text-danger">*</span></label>
                                <select class="form-select" id="add_direction" name="direction" required>
                                    <option value="">Select Direction</option>
                                    <option value="Out Going">Out Going</option>
                                    <option value="In Coming">In Coming</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_interaction_date" class="form-label">Date/Time</label>
                                <input type="datetime-local" class="form-control" id="add_interaction_date" name="interaction_date">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_status" class="form-label">Status</label>
                                <select class="form-select" id="add_status" name="status">
                                    <option value="Completed">Completed</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Failed">Failed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="add_subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="add_subject" name="subject" placeholder="Brief description of the interaction">
                    </div>
                    <div class="mb-3">
                        <label for="add_description" class="form-label">Description/Notes</label>
                        <textarea class="form-control" id="add_description" name="description" rows="4" placeholder="Detailed notes about the interaction"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_contact_id" class="form-label">Contact</label>
                                <select class="form-select" id="add_contact_id" name="contact_id">
                                    <option value="">Select Contact</option>
                                    <!-- Contacts will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_opportunity_id" class="form-label">Opportunity</label>
                                <select class="form-select" id="add_opportunity_id" name="opportunity_id">
                                    <option value="">Select Opportunity</option>
                                    <!-- Opportunities will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="add_project_id" class="form-label">Project</label>
                                <select class="form-select" id="add_project_id" name="project_id">
                                    <option value="">Select Project</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_duration_minutes" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="add_duration_minutes" name="duration_minutes" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="add_location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="add_location" name="location" placeholder="Meeting location or phone number">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="add_outcome" class="form-label">Outcome</label>
                        <textarea class="form-control" id="add_outcome" name="outcome" rows="2" placeholder="Result or outcome of the interaction"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInteraction()">Save Interaction</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro view_interaction_modal() %}
<div class="modal fade" id="viewInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-eye"></i> View Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="viewInteractionContent">
                <!-- Content will be loaded via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editInteractionFromView()">Edit</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{% macro edit_interaction_modal() %}
<div class="modal fade" id="editInteractionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Interaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editInteractionForm">
                    <input type="hidden" id="edit_interaction_id" name="id">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_type" class="form-label">Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="edit_type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="Call">Call</option>
                                    <option value="Email">Email</option>
                                    <option value="LinkedIn">LinkedIn</option>
                                    <option value="Text">Text</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_direction" class="form-label">Direction <span class="text-danger">*</span></label>
                                <select class="form-select" id="edit_direction" name="direction" required>
                                    <option value="">Select Direction</option>
                                    <option value="Out Going">Out Going</option>
                                    <option value="In Coming">In Coming</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_status" class="form-label">Status</label>
                                <select class="form-select" id="edit_status" name="status">
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Failed">Failed</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_interaction_date" class="form-label">Date/Time</label>
                                <input type="datetime-local" class="form-control" id="edit_interaction_date" name="interaction_date">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="edit_subject" name="subject">
                    </div>
                    <div class="mb-3">
                        <label for="edit_description" class="form-label">Description/Notes</label>
                        <textarea class="form-control" id="edit_description" name="description" rows="4"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_contact_id" class="form-label">Contact</label>
                                <select class="form-select" id="edit_contact_id" name="contact_id">
                                    <option value="">Select Contact</option>
                                    <!-- Contacts will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_opportunity_id" class="form-label">Opportunity</label>
                                <select class="form-select" id="edit_opportunity_id" name="opportunity_id">
                                    <option value="">Select Opportunity</option>
                                    <!-- Opportunities will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_project_id" class="form-label">Project</label>
                                <select class="form-select" id="edit_project_id" name="project_id">
                                    <option value="">Select Project</option>
                                    <!-- Projects will be loaded via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <!-- Empty column for alignment -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_duration_minutes" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="edit_duration_minutes" name="duration_minutes" min="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="edit_location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="edit_location" name="location">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="edit_outcome" class="form-label">Outcome</label>
                        <textarea class="form-control" id="edit_outcome" name="outcome" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="updateInteraction()">Update Interaction</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}
