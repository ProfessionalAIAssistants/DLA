{% extends "base.html" %}
{% from 'macros/contact_macros.html' import quick_actions_card, contact_stats_card, account_info_card, edit_contact_modal, add_interaction_modal, assign_account_modal, activity_timeline_card %}
{% from 'macros/contact_content_macros.html' import contact_header, contact_info_card, recent_interactions_card, related_opportunities_card %}

{% block title %}{{ contact.first_name }} {{ contact.last_name }} - CDE Prosperity{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    {{ contact_header(contact) }}

    <!-- Contact Summary -->
    <div class="row">
        <div class="col-xl-8">
            <!-- Basic Information -->
            {{ contact_info_card(contact) }}

            <!-- Recent Interactions -->
            {{ recent_interactions_card(interactions) }}

            <!-- Related Opportunities -->
            {{ related_opportunities_card(opportunities) }}
        </div>

    <!-- Sidebar -->
    <div class="col-xl-4">
        <!-- Quick Actions -->
        {{ quick_actions_card(contact) }}

        <!-- Contact Statistics -->
        {{ contact_stats_card(interactions|length, opportunities|length) }}

        <!-- Account Information -->
        {{ account_info_card(account) }}

        <!-- Activity Timeline -->
        {{ activity_timeline_card(contact, interactions, tasks, opportunities) }}
    </div>
</div>

<!-- Modals -->
{{ edit_contact_modal() }}
{{ add_interaction_modal() }}
{{ assign_account_modal() }}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/contact_detail.js') }}"></script>
<script>
// Ensure opportunity functions are globally available immediately
window.viewOpportunity = function(id) {
    window.location.href = '/opportunity/' + id;
};

window.editOpportunity = function(id) {
    window.location.href = '/opportunity/' + id + '?edit=true';
};

// Initialize contact detail functionality
document.addEventListener('DOMContentLoaded', function() {
    ContactDetailJS.init({{ contact.id }});
});
</script>

<style>
/* Custom styles for enhanced visual appeal */
.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
}

.btn {
    transition: all 0.3s ease;
}
</style>
{% endblock %}
